# C3 语言

C3 是 C 语言的一种进化，也是一种最小化的系统编程语言。

设计目标：

1. 生产性质的语言，而且可以简单的地完成工作
1. 简约，特性正好足够
1. 接近 C，只有必须的改进
1. 对于 C 程序员应该很容易上手
1. 和 C 无缝集成
1. 符合人体工学
1. 惰性数据设计
1. 初始化为零
1. 避免大聪明设计

C3 最早源于 Bas van de Berg 的 C2 语言，后面又独立演进。在错误处理，宏，泛型，字符串方面有更多新的设计。

## 路线图

C3 目前已经是性能稳定的状态，0.6.x 系列可用于生产项目。直到 1.0。

0.8 到 0.9 的重点是更新跨平台的标准和修订部分语言特性。同时工具链也是持续更新。

标准库在 1.0 之前会不断修改。

目前计划一年迭代一个 0.1 版本，在 2028 年发布 1.0。

## 数据类型

### 整数

有符号整数：ichar，short，int，long，int128，iptr，isz
无符号整数：char，ushort，uint，ulong，uint128，uptr，usz

在 64 位机器上，iptr/uptr，isz/usz 都是 64 位，如同 long/ulong。如果是在 32 位机器上，则相当于 int/uint。

字面量支持下面这些形式：

```c3
a = -2_00;
b = 0o770;
c = 0x7f7f7f;
d = 123;
```

字面量也支持后缀：

1. i8 -> ichar
1. i16 -> short
1. i32 -> int
1. i64 -> long
1. i128 -> int128
1. u8 -> char
1. u16 -> ushort
1. u32 -> uint
1. u -> uint
1. u64 -> ulong
1. u128 -> uint128

### 布尔值

bool 只有两个值：true，false。

### 字符字面量

字符字面量使用 `''` 单引号包裹。C3 支持单个字符字面量，也支持 2、4、8 个字符表示一个宽字面量。注意会转换为不同的类型，ushort，unit，ulong。

### 浮点数

只支持 float 和 double，两种类型。分别是 32 位浮点和 64 位浮点。

C3 的浮点数字面量也支持后续声明：

1. f32 -> float
1. f -> float
1. f64 -> double

### 数组

使用 `Type[size]` 形式声明数组，同时支持 `Type[*]` 由编译器自动推导长度。比如：

```c3
int[3] abc = { 1, 2, 3 };
int[*] bcd = { 1, 2, 3 };
```

### 切片

切片类型使用 `Type[]` 形式声明。切片不保存数据，切片更像是数组或向量的一个视图。

切片有两个属性 `.ptr` 指向切片引用的数组，`.len` 表示切片的长度。

### 向量

向量使用 `Type[<*>]` 形式声明。向量是基于硬件的 SIMD 向量。支持很多并行的操作。

向量也使用 `{ ... }` 形式使用字面量初始化。

比如：

```c3
int[<*>] b = { 1, 2 };
int[<2>] c = { 2, 4 };
int[<2>] d =  b * c；// => { 2, 8 }
```

### 字符串

字符串字面量非常特别，可以转换为不同类型的数组和切片。字符串字面量使用 `" "` 包裹，特殊符号需要使用转义符号。

C3 也提供了原始字符串支持，使用 \`\` （反引号）包裹。在原始字符串中不支持使用转义符号。

可以使用 String、ZString、char[]、chat* 声明一个字符串变量。String 实际上是 char[] 的一个 inline 别名，ZString 则是 chart* 的别名。

注意 String 需要显式类型转换才能转换为 char[]，反之亦然。

### Base64 和 Hex 数据字面量

```c3
char[*] hello_world_base64 = b64"SGVsbG8gV29ybGQh";
char[*] hello_world_hex = x"4865 6c6c 6f20 776f 726c 6421";
```

### 指针

Type* 声明一个指针变量。比如 Foo* 表示声明了一个指向 Foo 类型的指针。指标可以设置为 null，表示一个无效、空指针。

### void*

万能指标。void* 表示一个可以转换为任意类型的指针。

## 变量

C3 默认会使用零值初始化变量。可以使用 `@noinit` 显式声明变量为 undefined，当然在使用该变量前必须先初始化。

示例：

```c3
int x; // x=0
int y @noinit; // y 为 undefined。在使用前需要初始化

AStruct foo; // 隐藏初始化为零值（编译器默认行为）
AStruct bar = {}; // 显式初始化为零值
AStruct baz @noinit; // 显式声明变量为 undefined
```


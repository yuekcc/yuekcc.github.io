import{e as a,h as n}from"/dist/chunk-scq2q67j.js";function s(){return n("div",{class:"markdown-body",children:n(a,{children:[n("h1",{children:"npm 小技巧"},void 0,!1,void 0,this),`
`,n("h2",{children:"binary_host"},void 0,!1,void 0,this),`
`,n("p",{children:["npm 支持为每个需要 binary 的包指定下载地址。所谓的 binary 是指基于 napi 开发的模块，通过使用 c/c++ 实现，后续一般是 ",n("code",{children:".node"},void 0,!1,void 0,this),"。"]},void 0,!0,void 0,this),`
`,n("p",{children:["例如有一个包 ",n("code",{children:"better-sqlite3"},void 0,!1,void 0,this),"，那么它需要的二进制文件下载可以通过 ",n("code",{children:"<包名>_binary_host"},void 0,!1,void 0,this)," 环境变量来指定。",n("code",{children:"better-sqlite3"},void 0,!1,void 0,this)," 的 binary_host 应该是 ",n("code",{children:"better-sqlite3_binary_host"},void 0,!1,void 0,this),"。虽说是环境变量，也可以直接写在 ",n("code",{children:".npmrc"},void 0,!1,void 0,this)," 中，全局或当前仓库也可以。我通常使用本地仓库的 ",n("code",{children:".npmrc"},void 0,!1,void 0,this),"，这样不会污染全局的配置。"]},void 0,!0,void 0,this),`
`,n("p",{children:["另外，这个 binary_host 是通过 http/https 访问，因此也可以使用 ",n("a",{href:"http://ghproxy.com",children:"ghproxy.com"},void 0,!1,void 0,this)," 的代理地址。比如上面的 ",n("code",{children:"better-sqlite3_binary_host"},void 0,!1,void 0,this),"，可以设置为："]},void 0,!0,void 0,this),`
`,n("pre",{className:"shiki github-dark",style:{backgroundColor:"#24292e",color:"#e1e4e8"},tabIndex:"0",children:n("code",{className:"language-sh",children:[n("span",{className:"line",children:[n("span",{style:{color:"#E1E4E8"},children:"better-sqlite3_binary_host"},void 0,!1,void 0,this),n("span",{style:{color:"#F97583"},children:"="},void 0,!1,void 0,this),n("span",{style:{color:"#9ECBFF"},children:"https://ghproxy.com/https://github.com/WiseLibs/better-sqlite3/releases/download"},void 0,!1,void 0,this)]},void 0,!0,void 0,this),`
`,n("span",{className:"line",children:[n("span",{style:{color:"#E1E4E8"},children:"npm_config_better_sqlite3_binary_host"},void 0,!1,void 0,this),n("span",{style:{color:"#F97583"},children:"="},void 0,!1,void 0,this),n("span",{style:{color:"#9ECBFF"},children:"https://ghproxy.com/https://github.com/WiseLibs/better-sqlite3/releases/download"},void 0,!1,void 0,this)]},void 0,!0,void 0,this),`
`,n("span",{className:"line"},void 0,!1,void 0,this),`
`,n("span",{className:"line",children:n("span",{style:{color:"#6A737D"},children:"# 如果通过指定 tag，可以使用下面这种形式："},void 0,!1,void 0,this)},void 0,!1,void 0,this),`
`,n("span",{className:"line",children:[n("span",{style:{color:"#B392F0"},children:"uWebSockets.js_binary_host"},void 0,!1,void 0,this),n("span",{style:{color:"#9ECBFF"},children:"=https://ghproxy.com/https://github.com/uNetworking/uWebSockets.js/tree/v20.10.0"},void 0,!1,void 0,this)]},void 0,!0,void 0,this)]},void 0,!0,void 0,this)},void 0,!1,void 0,this),`
`,n("p",{children:["安装 .node 模块一般是通过 prebuild-install 包实现，在 ",n("code",{children:"prebuild-install@^7.0.0"},void 0,!1,void 0,this)," 按照下面的函数生成环境变量名："]},void 0,!0,void 0,this),`
`,n("pre",{className:"shiki github-dark",style:{backgroundColor:"#24292e",color:"#e1e4e8"},tabIndex:"0",children:n("code",{className:"language-js",children:[n("span",{className:"line",children:n("span",{style:{color:"#6A737D"},children:"// node_modules/prebuild-install/util.js"},void 0,!1,void 0,this)},void 0,!1,void 0,this),`
`,n("span",{className:"line",children:[n("span",{style:{color:"#F97583"},children:"function"},void 0,!1,void 0,this),n("span",{style:{color:"#B392F0"},children:" getEnvPrefix"},void 0,!1,void 0,this),n("span",{style:{color:"#E1E4E8"},children:"("},void 0,!1,void 0,this),n("span",{style:{color:"#FFAB70"},children:"pkgName"},void 0,!1,void 0,this),n("span",{style:{color:"#E1E4E8"},children:") {"},void 0,!1,void 0,this)]},void 0,!0,void 0,this),`
`,n("span",{className:"line",children:[n("span",{style:{color:"#F97583"},children:"  return"},void 0,!1,void 0,this),n("span",{style:{color:"#9ECBFF"},children:" 'npm_config_'"},void 0,!1,void 0,this),n("span",{style:{color:"#F97583"},children:" +"},void 0,!1,void 0,this),n("span",{style:{color:"#E1E4E8"},children:" (pkgName "},void 0,!1,void 0,this),n("span",{style:{color:"#F97583"},children:"||"},void 0,!1,void 0,this),n("span",{style:{color:"#9ECBFF"},children:" ''"},void 0,!1,void 0,this),n("span",{style:{color:"#E1E4E8"},children:")."},void 0,!1,void 0,this),n("span",{style:{color:"#B392F0"},children:"replace"},void 0,!1,void 0,this),n("span",{style:{color:"#E1E4E8"},children:"("},void 0,!1,void 0,this),n("span",{style:{color:"#9ECBFF"},children:"/"},void 0,!1,void 0,this),n("span",{style:{color:"#79B8FF"},children:"["},void 0,!1,void 0,this),n("span",{style:{color:"#F97583"},children:"^"},void 0,!1,void 0,this),n("span",{style:{color:"#79B8FF"},children:"a-zA-Z0-9]"},void 0,!1,void 0,this),n("span",{style:{color:"#9ECBFF"},children:"/"},void 0,!1,void 0,this),n("span",{style:{color:"#F97583"},children:"g"},void 0,!1,void 0,this),n("span",{style:{color:"#E1E4E8"},children:", "},void 0,!1,void 0,this),n("span",{style:{color:"#9ECBFF"},children:"'_'"},void 0,!1,void 0,this),n("span",{style:{color:"#E1E4E8"},children:")."},void 0,!1,void 0,this),n("span",{style:{color:"#B392F0"},children:"replace"},void 0,!1,void 0,this),n("span",{style:{color:"#E1E4E8"},children:"("},void 0,!1,void 0,this),n("span",{style:{color:"#9ECBFF"},children:"/"},void 0,!1,void 0,this),n("span",{style:{color:"#F97583"},children:"^"},void 0,!1,void 0,this),n("span",{style:{color:"#DBEDFF"},children:"_"},void 0,!1,void 0,this),n("span",{style:{color:"#9ECBFF"},children:"/"},void 0,!1,void 0,this),n("span",{style:{color:"#E1E4E8"},children:", "},void 0,!1,void 0,this),n("span",{style:{color:"#9ECBFF"},children:"''"},void 0,!1,void 0,this),n("span",{style:{color:"#E1E4E8"},children:");"},void 0,!1,void 0,this)]},void 0,!0,void 0,this),`
`,n("span",{className:"line",children:n("span",{style:{color:"#E1E4E8"},children:"}"},void 0,!1,void 0,this)},void 0,!1,void 0,this),`
`,n("span",{className:"line"},void 0,!1,void 0,this),`
`,n("span",{className:"line",children:[n("span",{style:{color:"#F97583"},children:"function"},void 0,!1,void 0,this),n("span",{style:{color:"#B392F0"},children:" getHostMirrorUrl"},void 0,!1,void 0,this),n("span",{style:{color:"#E1E4E8"},children:"("},void 0,!1,void 0,this),n("span",{style:{color:"#FFAB70"},children:"opts"},void 0,!1,void 0,this),n("span",{style:{color:"#E1E4E8"},children:") {"},void 0,!1,void 0,this)]},void 0,!0,void 0,this),`
`,n("span",{className:"line",children:[n("span",{style:{color:"#F97583"},children:"  const"},void 0,!1,void 0,this),n("span",{style:{color:"#79B8FF"},children:" propName"},void 0,!1,void 0,this),n("span",{style:{color:"#F97583"},children:" ="},void 0,!1,void 0,this),n("span",{style:{color:"#B392F0"},children:" getEnvPrefix"},void 0,!1,void 0,this),n("span",{style:{color:"#E1E4E8"},children:"(opts.pkg.name) "},void 0,!1,void 0,this),n("span",{style:{color:"#F97583"},children:"+"},void 0,!1,void 0,this),n("span",{style:{color:"#9ECBFF"},children:" '_binary_host'"},void 0,!1,void 0,this),n("span",{style:{color:"#E1E4E8"},children:";"},void 0,!1,void 0,this)]},void 0,!0,void 0,this),`
`,n("span",{className:"line",children:[n("span",{style:{color:"#F97583"},children:"  return"},void 0,!1,void 0,this),n("span",{style:{color:"#E1E4E8"},children:" process.env[propName] "},void 0,!1,void 0,this),n("span",{style:{color:"#F97583"},children:"||"},void 0,!1,void 0,this),n("span",{style:{color:"#E1E4E8"},children:" process.env[propName "},void 0,!1,void 0,this),n("span",{style:{color:"#F97583"},children:"+"},void 0,!1,void 0,this),n("span",{style:{color:"#9ECBFF"},children:" '_mirror'"},void 0,!1,void 0,this),n("span",{style:{color:"#E1E4E8"},children:"];"},void 0,!1,void 0,this)]},void 0,!0,void 0,this),`
`,n("span",{className:"line",children:n("span",{style:{color:"#E1E4E8"},children:"}"},void 0,!1,void 0,this)},void 0,!1,void 0,this)]},void 0,!0,void 0,this)},void 0,!1,void 0,this),`
`,n("p",{children:["有一点需要补充。如果 npm 包官方已经提供的环境变更用于下载 ",n("code",{children:".node"},void 0,!1,void 0,this)," 文件。应该按照官方的说明操作。"]},void 0,!0,void 0,this),`
`,n("h2",{children:"git+https 包地址"},void 0,!1,void 0,this),`
`,n("p",{children:["有一些包，只发布到 github。因为需要使用 github 为下载地址。比如 ",n("code",{children:"uWebSockets.js"},void 0,!1,void 0,this),"，为其官方的说明，npm install 实现是增加了一个 github 地址。考虑到国内的网络环境。可以使用 ",n("code",{children:"git+https"},void 0,!1,void 0,this)," 来代替："]},void 0,!0,void 0,this),`
`,n("pre",{className:"shiki github-dark",style:{backgroundColor:"#24292e",color:"#e1e4e8"},tabIndex:"0",children:n("code",{className:"language-jsonc",children:[n("span",{className:"line",children:n("span",{style:{color:"#E1E4E8"},children:"{"},void 0,!1,void 0,this)},void 0,!1,void 0,this),`
`,n("span",{className:"line",children:n("span",{style:{color:"#6A737D"},children:"  // ..."},void 0,!1,void 0,this)},void 0,!1,void 0,this),`
`,n("span",{className:"line",children:[n("span",{style:{color:"#79B8FF"},children:'  "dependencies"'},void 0,!1,void 0,this),n("span",{style:{color:"#E1E4E8"},children:": {"},void 0,!1,void 0,this)]},void 0,!0,void 0,this),`
`,n("span",{className:"line",children:[n("span",{style:{color:"#79B8FF"},children:'    "uWebSockets.js"'},void 0,!1,void 0,this),n("span",{style:{color:"#E1E4E8"},children:": "},void 0,!1,void 0,this),n("span",{style:{color:"#9ECBFF"},children:'"git+https://ghproxy.com/https://github.com/uNetworking/uWebSockets.js#v20.10.0"'},void 0,!1,void 0,this)]},void 0,!0,void 0,this),`
`,n("span",{className:"line",children:n("span",{style:{color:"#6A737D"},children:"    // ..."},void 0,!1,void 0,this)},void 0,!1,void 0,this),`
`,n("span",{className:"line",children:n("span",{style:{color:"#E1E4E8"},children:"  }"},void 0,!1,void 0,this)},void 0,!1,void 0,this),`
`,n("span",{className:"line",children:n("span",{style:{color:"#E1E4E8"},children:"}"},void 0,!1,void 0,this)},void 0,!1,void 0,this)]},void 0,!0,void 0,this)},void 0,!1,void 0,this),`
`,n("hr",{},void 0,!1,void 0,this),`
`,n("p",{children:"2022 年 10 月 03 日"},void 0,!1,void 0,this)]},void 0,!0,void 0,this)},void 0,!1,void 0,this)}export{s as default};
